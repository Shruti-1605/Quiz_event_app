{% extends 'quiz_events_app/base.html' %}
{% block title %}Quiz Results - {{ submission.quiz.title }}{% endblock %}
{% block content %}

<!-- Results Header -->
<div class="bg-gradient-to-r from-sky-600 to-blue-600 text-white py-12">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <div class="mb-6">
      {% if submission.score >= 80 %}
        <i class="fas fa-trophy text-6xl text-cyan-300 mb-4"></i>
        <h1 class="text-4xl md:text-5xl font-bold mb-2">Excellent Work!</h1>
      {% elif submission.score >= 60 %}
        <i class="fas fa-medal text-6xl text-sky-200 mb-4"></i>
        <h1 class="text-4xl md:text-5xl font-bold mb-2">Good Job!</h1>
      {% else %}
        <i class="fas fa-graduation-cap text-6xl text-sky-200 mb-4"></i>
        <h1 class="text-4xl md:text-5xl font-bold mb-2">Keep Learning!</h1>
      {% endif %}
    </div>
    
    <p class="text-xl text-sky-100 mb-4">
      Well done, <strong>{{ submission.user.username }}</strong>!
    </p>
    
    <div class="inline-flex items-center bg-white/20 backdrop-blur-sm rounded-2xl px-6 py-4 max-w-xs">
      <div class="text-center w-full">
        <div class="text-3xl md:text-4xl font-bold text-white mb-1 break-words">{{ submission.score }}%</div>
        <div class="text-green-100 text-sm">Your Score</div>
      </div>
    </div>
  </div>
</div>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  
  <!-- Score Summary -->
  <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-gray-100">
    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Quiz Summary</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="text-center p-6 bg-gradient-to-br from-sky-50 to-blue-50 rounded-xl">
        <i class="fas fa-question-circle text-3xl text-sky-600 mb-3"></i>
        <div class="text-2xl font-bold text-gray-900">{{ processed_answers|length }}</div>
        <div class="text-gray-600">Total Questions</div>
      </div>
      <div class="text-center p-6 bg-gradient-to-br from-cyan-50 to-sky-50 rounded-xl">
        <i class="fas fa-check-circle text-3xl text-cyan-600 mb-3"></i>
        <div class="text-2xl font-bold text-gray-900">{% widthratio submission.score 100 processed_answers|length %}</div>
        <div class="text-gray-600">Correct Answers</div>
      </div>
      <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-sky-50 rounded-xl">
        <i class="fas fa-percentage text-3xl text-blue-600 mb-3"></i>
        <div class="text-2xl font-bold text-gray-900">{{ submission.score }}%</div>
        <div class="text-gray-600">Final Score</div>
      </div>
    </div>
  </div>

  <!-- Detailed Results -->
  <div class="mb-8">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Detailed Results</h2>
    <div class="space-y-6">
      {% for item in processed_answers %}
        {% with ua=item.ua correct=item.correct_answer %}
        <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
          <div class="flex items-start mb-4">
            <div class="w-10 h-10 {% if ua.is_correct %}bg-green-500{% else %}bg-red-500{% endif %} rounded-full flex items-center justify-center mr-4 flex-shrink-0">
              <span class="text-white font-bold text-sm">{{ forloop.counter }}</span>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-gray-900 mb-3 break-words">{{ ua.question.text }}</h3>
              
              <div class="space-y-3">
                <!-- Your Answer -->
                <div class="p-4 {% if ua.is_correct %}bg-green-50 border border-green-200{% else %}bg-red-50 border border-red-200{% endif %} rounded-xl">
                  <div class="flex items-center mb-2">
                    <i class="fas fa-user text-sm {% if ua.is_correct %}text-green-600{% else %}text-red-600{% endif %} mr-2"></i>
                    <span class="font-medium {% if ua.is_correct %}text-green-800{% else %}text-red-800{% endif %}">Your Answer:</span>
                  </div>
                  <div class="{% if ua.is_correct %}text-green-700{% else %}text-red-700{% endif %} break-words">
                    {% if ua.answer %}
                      {{ ua.answer.text }}
                    {% else %}
                      <span class="italic">Not answered</span>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Correct Answer (if wrong) -->
                {% if not ua.is_correct and correct %}
                  <div class="p-4 bg-sky-50 border border-sky-200 rounded-xl">
                    <div class="flex items-center mb-2">
                      <i class="fas fa-lightbulb text-sm text-sky-600 mr-2"></i>
                      <span class="font-medium text-sky-800">Correct Answer:</span>
                    </div>
                    <div class="text-sky-700 break-words">{{ correct.text }}</div>
                  </div>
                {% endif %}
              </div>
              
              <!-- Status Badge -->
              <div class="mt-4">
                {% if ua.is_correct %}
                  <span class="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                    <i class="fas fa-check mr-1"></i>
                    Correct
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
                    <i class="fas fa-times mr-1"></i>
                    Incorrect
                  </span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endwith %}
      {% endfor %}
    </div>
  </div>
  
  <!-- Action Buttons -->
  <div class="text-center space-y-4 sm:space-y-0 sm:space-x-4 sm:flex sm:justify-center">
    <a href="{% url 'quiz_events_app:quiz_list' %}" class="inline-flex items-center px-8 py-3 bg-gradient-to-r from-sky-600 to-blue-600 text-white font-semibold rounded-xl hover:shadow-lg transition duration-300">
      <i class="fas fa-redo mr-2"></i>
      Try Another Quiz
    </a>
    <a href="{% url 'quiz_events_app:home' %}" class="inline-flex items-center px-8 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition duration-300">
      <i class="fas fa-home mr-2"></i>
      Back to Home
    </a>
  </div>
  
</div>

{% endblock %}
